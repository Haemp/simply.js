<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="simply.js"></script>


    <script>
        document.registerElement('ah-sandbox', class Sandbox extends HTMLElement{
            createdCallback(){
                this.innerHTML = `
                    <style>
                        .actions{
                            position: absolute;
                            bottom: 0px;
                        }
                    </style>
                    <input type="text" value="/ProgressBar.js" #el-url (keypress == 'Enter')="$value.key === 'Enter' ? this.fetchUrl(this.elUrl.value) : null">
                    <iframe #container></iframe>

                    <div class="actions">
                        <input #range type="range" max="1" min="0" step="0.1" (change)="this.cont.update(this.range.value)">
                    </div>
                `;

                Simply.compile(this);
                this.container.addEventListener('load', () => {
                    this.init()

                });
                setInterval(() => {
                    this.fetchUrl(this.elUrl.value);
                }, 500)
            }

            fetchUrl(url){
                fetch(url).then((resp) => {
                    return resp.text();
                }).then((scriptContent) => {

                    this.scriptContent = scriptContent;
                    if(this.scriptContent === this.activeScriptContent){
                        return;
                    }else{
                        this.container.contentWindow.location.reload();
                    }
                });
            }

            init(){

                // get the file

                // parse the file for it's APIs

                // create controlls for those APIs
                // for example if the element is a todo element
                // we might have editable/inditable

                // todo: states - simple api variables to bind to
                // enabled

                try{
                    new Function(this.scriptContent).call({document: this.container.contentDocument});    
                }catch(e){
                    console.log(e);
                }
                

                // now we add the component
                // This is the setup stage
                this.container.contentDocument.body.innerHTML = '<sh-progress-bar #cont ></sh-progress-bar>';
                Simply.compile(this.container.contentDocument.body);
                this.cont = this.container.contentDocument.body.cont;

                this.cont.update(0.3);
                this.activeScriptContent = this.scriptContent;
            }
        });
    </script>
</head>
<body>
    <ah-sandbox></ah-sandbox>
</body>
</html>